#!/usr/bin/env python3
"""CVE Watcher – OC-0188"""

import argparse
import os
import sys

RED = "\033[91m"
GREEN = "\033[92m"
YELLOW = "\033[93m"
RESET = "\033[0m"

def check_env():
    if not os.environ.get("SLACK_WEBHOOK_URL"):
        print(f"{RED}Error: SLACK_WEBHOOK_URL is not set{RESET}")
        sys.exit(1)

def monitor(args):
    check_env()
    print(f"{YELLOW}Monitoring vulnerability databases for stack: {args.stack}{RESET}")
    # Mock monitoring logic
    print(f"{GREEN}Monitoring active. Notifications will be sent to the configured webhook.{RESET}")

def alert(args):
    check_env()
    print(f"{YELLOW}Dispatching alert for {args.cve}...{RESET}")
    # Mock alert dispatching
    print(f"{GREEN}Alert sent successfully for {args.cve}.{RESET}")

def main():
    parser = argparse.ArgumentParser(description="CVE Watcher – OC-0188")
    sub = parser.add_subparsers(dest="command", required=True)

    p_monitor = sub.add_parser("monitor", help="Monitor databases for new CVEs by technology stack")
    p_monitor.add_argument("--stack", required=True, help="Comma-separated list of technologies")

    p_alert = sub.add_parser("alert", help="Dispatch alerts based on detected CVEs")
    p_alert.add_argument("--cve", required=True, help="CVE identifier (e.g. CVE-2024-XXXX)")

    args = parser.parse_args()
    
    if args.command == "monitor":
        monitor(args)
    elif args.command == "alert":
        alert(args)

if __name__ == "__main__":
    main()
